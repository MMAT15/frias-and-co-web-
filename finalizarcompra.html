<!DOCTYPE html>
<html lang="es">
  <head>
    <!-- General -->
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- SEO & Social -->
    <title>BERA Clothing | Finalizar compra</title>
    <meta
      name="description"
      content="Finaliz√° tu compra en BERA Clothing: revis√° tu pedido y pag√° con Mercado Pago o efectivo (10% de descuento). Retiro en local o punto de encuentro."
    />
    <meta name="theme-color" content="#e91e63" />
    <link rel="icon" href="assets/images/favicon.ico" />

    <!-- Typography -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap"
      rel="stylesheet"
    />

    <!-- Styles -->
    <link rel="stylesheet" href="css/checkout.css" />
    <link rel="stylesheet" href="css/style.css" />

  </head>
<body>
    <!-- HEADER -->
  <header class="site-header" role="banner">
    <div class="container header-inner">
   <button class="collection-toggle"
        aria-label="Abrir men√∫ Cat√°logo"
        aria-expanded="false"
        aria-controls="collection-menu">
  <span class="collection-label">Cat√°logo</span>
  <svg class="icon-hanger" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
    <path d="M12 7.5c0-.8-.6-1.5-1.4-1.5S9 6.7 9 7.5c0 .9.7 1.3 1.5 1.8.6.4 1.1.7 1.1 1.2 0 .5-.4.9-1 .9H10"
          fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
    <path d="M3 16.5l9-6 9 6" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
  </svg>
</button>
<!-- Bot√≥n lupita (desktop) -->
<button class="header-search-toggle" type="button" aria-label="Abrir b√∫squeda">
  <svg viewBox="0 0 24 24" aria-hidden="true">
    <path d="M11 18a7 7 0 1 1 4.95-2.05L21 21l-1.5 1.5-5.05-5.05A6.96 6.96 0 0 1 11 18z" fill="currentColor"/>
  </svg>
</button>

<!-- Campo que se despliega desde la lupita (desktop) -->
<form class="header-search header-search-desktop" role="search" aria-label="Buscar (desktop)" action="productos.html" method="get">
  <input class="header-search-input" name="q" type="search" placeholder="Buscar prendas‚Ä¶" autocomplete="off" />
  <button class="header-search-btn" aria-label="Buscar">
    <svg viewBox="0 0 24 24" aria-hidden="true">
      <path d="M11 18a7 7 0 1 1 4.95-2.05L21 21l-1.5 1.5-5.05-5.05A6.96 6.96 0 0 1 11 18z" fill="currentColor"/>
    </svg>
  </button>
</form>
    <div class="site-branding">
  <a href="index.html" class="logo-link" aria-label="Inicio">
    <div class="logo-wrap">
      <img src="assets/images/logoo.jpeg" alt="Logo BERA clothing" class="logo" />
    </div>
  </a>
  <div class="site-title" aria-label="BERA CLOTHING">
    <span class="title-bera">BERA</span>
    <span class="title-clothing">CLOTHING</span>
  </div>
  <span class="site-tagline">BY FRIAS</span>
</div>

      <button class="nav-toggle"
              aria-controls="primary-navigation"
              aria-expanded="false"
              aria-label="Abrir men√∫">
        <span class="bar"></span><span class="bar"></span><span class="bar"></span>
      </button>

      <nav id="primary-navigation" class="main-nav"
     role="navigation"
     aria-label="Men√∫ principal">

  <!-- ===== Buscador dentro del men√∫ (mobile) ===== -->
  <form class="menu-search" action="productos.html" method="get" role="search" aria-label="Buscar prendas">
    <label class="visually-hidden" for="menu-search-input">Buscar</label>
    <input
      id="menu-search-input"
      type="search"
      name="q"
      class="menu-search-input"
      placeholder="Buscar prendas..."
      autocomplete="off"
      aria-label="Buscar"
    />
    <button class="menu-search-btn" type="submit" aria-label="Buscar">
      <svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" focusable="false">
        <circle cx="11" cy="11" r="7" stroke="currentColor" stroke-width="2" fill="none"></circle>
        <line x1="16.5" y1="16.5" x2="21" y2="21" stroke="currentColor" stroke-width="2" stroke-linecap="round"></line>
      </svg>
    </button>
  </form>
  <!-- ============================================ -->

  <ul class="nav-list">
    <li><a href="index.html" class="active" aria-current="page">Inicio</a></li>
    <li><a href="newsletter.html">Novedades</a></li>
    <li><a href="productos.html">Productos</a></li>
    <li><a href="contacto.html">Contacto</a></li>
  </ul>
</nav>
     
    </div>
  </header>

    <!-- MAIN CONTENT -->
    <main id="main-content" tabindex="-1">
      <!-- Hero -->
      <section class="section section-hero" aria-labelledby="hero-title">
        <div class="container">
          <h1 id="hero-title" class="section-title">Finalizar compra</h1>
          <p class="hero-subtitle">
            Confirm√° tu pedido. Pag√° con efectivo (10% de descuento) o con Mercado Pago. Al confirmar te llevamos a nuestro perfil de Instagram (@beraclothingg) y ya dejamos el resumen copiado para que lo pegues y nos escribas por DM. Retiro en local o punto de encuentro (a coordinar).
          </p>
        </div>
      </section>

      <!-- Checkout -->
      <section class="section section-checkout">
        <div class="container checkout-container">
          <!-- Resumen -->
          <aside
            class="checkout-summary-panel"
            aria-labelledby="summary-title"
          >
            <h2 id="summary-title" class="panel-title">Resumen de tu pedido</h2>
            <ul class="order-items" role="list">
              <!-- JS inyecta productos aqu√≠ -->
            </ul>

            <dl class="summary-totals" aria-live="polite" id="summary-totals">
              <div class="summary-row">
                <dt>Subtotal (precio final con IVA)</dt>
                <dd id="summary-subtotal">$0</dd>
              </div>
              <div class="summary-row">
                <dt>Precio sin impuestos (‚àí21% IVA)</dt>
                <dd id="summary-net">$0</dd>
              </div>
              <div class="summary-row">
                <dt>Descuento en efectivo (10%)</dt>
                <dd id="summary-cash-discount">‚àí$0</dd>
              </div>
              <div class="summary-row total">
                <dt>Total a pagar</dt>
                <dd id="summary-total">$0</dd>
              </div>
            </dl>
            <p class="summary-note">El descuento del 10% aplica solo pagando en efectivo. Con Mercado Pago se abona el precio final sin descuento.</p>
          </aside>

          <!-- Formulario -->
          <form
            id="checkout-form"
            class="checkout-form"
            autocomplete="on"
            novalidate
          >
            <!-- Datos de env√≠o -->
            <fieldset class="form-group" aria-labelledby="legend-shipping-data">
              <legend id="legend-shipping-data">Datos de env√≠o</legend>

              <fieldset class="form-group" aria-labelledby="legend-delivery-method">
                <legend id="legend-delivery-method">Entrega</legend>
                <div class="shipping-methods">
                  <label class="option-wrapper">
                    <input type="radio" name="delivery" value="pickup" checked />
                    <span class="option-label">Retiro en local</span>
                    <span class="option-detail">Gratis</span>
                  </label>
                  <label class="option-wrapper">
                    <input type="radio" name="delivery" value="meetup" />
                    <span class="option-label">Punto de encuentro</span>
                    <span class="option-detail">A coordinar </span>
                  </label>
                </div>
              </fieldset>

              <div class="pickup-map" role="region" aria-label="Mapa del punto de retiro">
                <h3 class="panel-subtitle">Retiro en local</h3>
                <p>Calle 10 N¬∞ 4629, Berazategui, Buenos Aires</p>
                <div class="map-embed">
                  <iframe
                    src="https://www.google.com/maps?q=Calle+10+4629+Berazategui+Buenos+Aires&output=embed"
                    width="100%" height="220" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade">
                  </iframe>
                </div>
              </div>
            </fieldset>

            <!-- M√©todo de pago -->
            <fieldset class="form-group" aria-labelledby="legend-payment-method">
              <legend id="legend-payment-method">M√©todo de pago</legend>

              <div class="payment-methods">
                <label class="option-wrapper">
                  <input type="radio" name="payment" value="cash" checked />
                  <span>Efectivo (10% de descuento)</span>
                </label>
                <label class="option-wrapper">
                  <input type="radio" name="payment" value="mercadopago" />
                  <span>Mercado Pago (precio final)</span>
                </label>
                <p class="payment-help" aria-live="polite">
                  Con efectivo aplicamos 10% de descuento sobre el precio final. Con Mercado Pago abon√°s el precio final sin descuento. Al presionar ‚ÄúConfirmar pedido‚Äù te vamos a redirigir a nuestro perfil de Instagram (@beraclothingg). Ya copiamos el resumen para que lo pegues y nos escribas por DM.
                </p>
              </div>
            </fieldset>

            <!-- Confirmaci√≥n -->
            <button type="button" id="confirm-order" class="btn btn-primary btn-block" aria-describedby="dm-title dm-instructions">
              Confirmar pedido
            </button>
          </form>
        </div>
      </section>
      <style>
        .summary-note{font-size:.9rem;color:#666;margin-top:.5rem}
        .panel-subtitle{margin:.5rem 0 .25rem;font-weight:600}
        .pickup-map .map-embed{margin-top:.5rem;border-radius:8px;overflow:hidden}
        .payment-methods .option-wrapper{display:flex;gap:.5rem;align-items:center;margin:.3rem 0}
      </style>
      <!-- ========== PRE-DM INSTAGRAM MODAL (simple) ========== -->
      <div id="dm-modal" class="pre-dm-modal" role="dialog" aria-modal="true" aria-labelledby="dm-title" aria-hidden="true" hidden>
        <div class="pre-dm-modal__content" role="document">
          <h2 id="dm-title" class="pre-dm-title">Vamos a abrir Instagram</h2>
          <p id="dm-instructions" class="pre-dm-body">
            Ahora te vamos a redirigir a nuestro perfil de Instagram (<strong>@beraclothingg</strong>).
            <br>El resumen de tu pedido ya qued√≥ <strong>copiado</strong>: cuando se abra Instagram, <strong>pegalo</strong> en un DM y toc√° enviar.
          </p>
          <!-- Nuevo aviso con contador (solo se debe ver antes de abrir IG) -->
          <p class="dm-countdown">Te redirigimos en <span id="dm-timer">15</span> segundos‚Ä¶</p>
          <p id="dm-redirecting" class="dm-redirecting" hidden>
            Abriendo Instagram‚Ä¶
          </p>
          <p class="dm-helper" aria-live="polite"></p>
          <div class="pre-dm-actions">
            <button id="dm-ack" class="btn">Entendido</button>
          </div>
        </div>
      </div>
      <!-- ========== /PRE-DM INSTAGRAM MODAL (simple) ========== -->
    </main>

    <!-- FOOTER -->
    <footer class="site-footer" role="contentinfo">
      <!-- (aqu√≠ va tu mismo footer de siempre) -->
    </footer>

    <!-- Scripts -->
    <script src="js/scriptt.js" defer></script>
    <script src="js/checkout.js" defer></script>
    <script>
(() => {
  const IG_USER = 'beraclothingg'; // sin @

  function readCart() {
    try {
      const raw = localStorage.getItem('cart');
      const cart = raw ? JSON.parse(raw) : [];
      return Array.isArray(cart) ? cart : [];
    } catch { return []; }
  }

  function money(n){ return '$' + (n||0).toLocaleString('es-AR'); }

  function selectedPayment() {
    const r = document.querySelector('input[name="payment"]:checked');
    // normalizamos a los valores usados m√°s abajo en buildMessage()
    return r ? (r.value === 'cash' ? 'efectivo' : 'mp') : 'efectivo';
  }

  function selectedPickup() {
    const r = document.querySelector('input[name="delivery"]:checked');
    // normalizamos a 'local' | 'punto' para el mensaje DM
    return r ? (r.value === 'pickup' ? 'local' : 'punto') : 'local';
  }

  function customerData() {
    const get = sel => (document.querySelector(sel)?.value || '').trim();
    return {
      nombre: get('#nombre') || get('[name="nombre"]'),
      email: get('#email') || get('[name="email"]'),
      telefono: get('#telefono') || get('[name="telefono"]'),
      notas: get('#notas') || get('[name="notas"]')
    };
  }

  function buildMessage() {
    const cart = readCart();
    const pay  = selectedPayment();
    const pick = selectedPickup();
    const data = customerData();

    const total = cart.reduce((s,i)=> s + (i.price||0) * (i.qty||1), 0);
    const totalEfectivo = Math.round(total * 0.9); // 10% off
    const iva = Math.round(total / 1.21);          // precio sin IVA (aprox. 21%)

    const lines = [];
    lines.push('¬°Hola! Quiero confirmar mi pedido:');
    if (cart.length === 0) lines.push('‚Äî (Carrito vac√≠o)');
    cart.forEach(i => {
      lines.push(`‚Ä¢ ${i.name} x${i.qty} ‚Äî ${money(i.price*i.qty)}`);
    });
    lines.push('');
    lines.push(`Total: ${money(total)}`);
    lines.push(`Precio sin impuestos (ref.): ${money(iva)}`);
    if (pay === 'efectivo') {
      lines.push(`M√©todo de pago: Efectivo (10% OFF) ‚Üí ${money(totalEfectivo)}`);
    } else {
      lines.push('M√©todo de pago: Mercado Pago (precio final).');
    }
    lines.push(`Retiro: ${pick === 'local' ? 'Local' : 'Punto de encuentro (a coordinar)'}`);
    if (pick === 'local') lines.push('Direcci√≥n: Calle 10 N¬∞ 4629, Berazategui');

    if (data.nombre)   lines.push(`Nombre: ${data.nombre}`);
    if (data.telefono) lines.push(`Tel√©fono: ${data.telefono}`);
    if (data.email)    lines.push(`Email: ${data.email}`);
    if (data.notas)    lines.push(`Notas: ${data.notas}`);

    return lines.join('\n');
  }

  function openInstagramDM(text) {
    // 1) Copiamos siempre el resumen al portapapeles (para pegar r√°pido en IG)
    navigator.clipboard?.writeText(text).catch(()=>{});

    // 2) Intento 1: abrir la app nativa de Instagram con deep link (algunos navegadores lo soportan)
    // Nota: Instagram no documenta un par√°metro oficial para pre-llenar el texto del DM,
    // por eso siempre copiamos el mensaje como respaldo.
    const appUrl = `instagram://direct`;
    let appTried = false;
    try {
      appTried = !!window.open(appUrl, '_self');
    } catch (_) {}

    // 3) Intento 2 (fallback web): abrir el chat/perfil via ig.me
    // En web IG no acepta texto pre-rellenado, por lo que el usuario deber√° pegar (Ctrl/Cmd+V).
    setTimeout(() => {
      // si seguimos visibles, asumimos que no se abri√≥ la app nativa
      if (document.visibilityState === 'visible') {
        window.location.href = `https://ig.me/m/${IG_USER}`;
      }
    }, 700);

    // 4) Aviso claro al usuario
    setTimeout(() => {
      if (document.visibilityState === 'visible') {
        alert('Te abr√≠ Instagram. Si el mensaje no aparece escrito, pegalo con Ctrl/Cmd+V. Ya copi√© el resumen por vos üëç');
      }
    }, 1200);
  }

  const confirmBtn = document.getElementById('confirm-order');
  const dmModal = document.getElementById('dm-modal');
  const dmTimer = document.getElementById('dm-timer');
  const dmRedirecting = document.getElementById('dm-redirecting');
  let countdownInterval;
  confirmBtn?.addEventListener('click', (e) => {
    e.preventDefault();
    confirmBtn.disabled = true;
    const msg = buildMessage();
    // Show modal and start countdown
    if (dmModal) {
      dmModal.classList.add('active');
      dmModal.setAttribute('aria-hidden', 'false');
      // Hide redirecting message if shown previously
      if (dmRedirecting) dmRedirecting.hidden = true;
      // Reset timer to 15
      let seconds = 15;
      if (dmTimer) dmTimer.textContent = seconds;
      // Clear any previous interval
      if (countdownInterval) clearInterval(countdownInterval);
      countdownInterval = setInterval(() => {
        seconds--;
        if (dmTimer) dmTimer.textContent = seconds;
        if (seconds <= 0) {
          clearInterval(countdownInterval);
          // Show redirecting message
          if (dmRedirecting) dmRedirecting.hidden = false;
          openInstagramDM(msg);
        }
      }, 1000);
    } else {
      // fallback if modal not found
      openInstagramDM(msg);
    }
    // reactivar por si el usuario vuelve atr√°s
    setTimeout(() => { confirmBtn.disabled = false; }, 3000);
  });
})();
</script>
  </body>
</html>